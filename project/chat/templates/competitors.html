{% extends "layout.html" %}

{% block content %}
  <div class="container-fluid col-8" align="center" style="width: 90%">
    <div class="container-fluid" style = "align = center">
      <table class = "chatTable" style="width:100%">
        <tr>
          <th class = "chatCells">Competitors</th>
          <th class = "chatCells" style = "width:60%">Chat</th>
          <th class = "chatCells">Info</th>
        </tr>
        <tr>
          <td class = "chatCells">
          </td>
          <td class = "chatCells">
            <div class="no_message">
            <h4 style='color: #ccc'>Start a conversation.</h1>
            <div class="message_holder"></div>
          </div>
           <form action = "" method="POST">
             <input id="text" class="message form-control" size="40" placeholder="Enter your message here"><br>
             <button type=submit class="btn" style="align: right">Send</button>
           </form>
          </td>
          <td class = "chatCells">
            <textarea readonly id="info" cols="20" rows="20" style="resize: none; align: top"></textarea>
          </td>
       </tr>
   </table>
 </div>
</div>

  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
  <script type="text/javascript" charset="utf-8">
      $(document).ready(function(){

        var socket = io.connect('http://' + document.domain + ':' + location.port);
        socket.on( 'connect', function() {
        socket.emit( 'my event', {
          data: 'User Connected'
        } )
        var form = $( 'form' ).on( 'submit', function( e ) {
          e.preventDefault()
          let user_name = null
          let user_input = $( '#text' ).val()
          socket.emit( 'my event', {
          //  user_name : user_name,
            message : user_input
          } )
          // empty the input field
          $( '#text' ).val( '' ).focus()
        } )
      } )
      // capture message
      socket.on( 'my_response', function( msg ) {
        console.log( msg )
        if( typeof msg.message !== 'undefined' ) {
          //$( '#chat' ).append('<li>'+msg+'</li>')
          $( 'h4' ).remove()
          $( 'div.message_holder' ).append( '<div class="msg_bbl"><b style="color: #000">'+msg.message+'</div>' )
        }
      } )

      });
    </script>

{% endblock %}
