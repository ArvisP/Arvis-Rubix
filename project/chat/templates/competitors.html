{% extends "layout.html" %}

{% block content %}
  <div class="container-fluid col-8" align="center" style="width: 100%">
    <div class="container-fluid" style = "align = center">
      <table class = "chatTable" style="width:100%">
        <tr>
          <th class = "chatCells">Competitors</th>
          <th class = "chatCells" style = "width:60%">Chat</th>
          <th class = "chatCells">Info</th>
        </tr>
        <tr>
          <td class = "chatCells">
          </td>
          <td class = "chatCells">
            <div id = "history" class="animated fadeInDown chatHistory">
              <div class="message_holder" style = "overflow: auto">
                {% if messages %}
                  {% for msg in messages %}
                    <div class="rcv_msg_bbl"><b style="color: #000">{{ msg[1] }}</div>
                  {% endfor %}
                {% else %}
                  <h4 style='color: #ccc'>Start a conversation.</h4>
                {% endif %}
              </div>
          </div>
           <form action = "" method="POST">
             <input id="text" class="animated fadeInDown message form-control" size="40"
                        placeholder="Enter your message here" autocomplete="off"></input>
             <button type=submit class="animated fadeInDown btn btn-dark btn-lg btn-block" style="align: right">Send</button>
           </form>
          </td>
          <td class = "chatCells">
            <textarea readonly id="info" cols="20" rows="20" style="resize: none; align: top"></textarea>
          </td>
       </tr>
   </table>
 </div>
</div>

  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
  <script type="text/javascript" charset="utf-8">
      $("#history").scrollTop($("#history")[0].scrollHeight);
      $(document).ready(function(){

        var socket = io.connect('http://' + document.domain + ':' + location.port);
        socket.on( 'connect', function() {
      //  socket.emit( 'my event', {
      //    data: 'User Connected'
      //  } )
        var form = $( 'form' ).on( 'submit', function( e ) {
          e.preventDefault()
          let user_name = null
          let user_input = $( '#text' ).val()
          if(user_input != ""){
            socket.emit( 'message',
            //  user_name : user_name,
                user_input
            )
            // empty the input field
            $( '#text' ).val( '' ).focus()
          }
        } )
      } )
      // capture message
      socket.on( 'my_response', function( msg ) {
        console.log( msg )
        if( typeof msg !== 'undefined' ) {
          $( 'h4' ).remove()
          $( 'div.message_holder' ).append( '<div class="sent_msg_bbl"><b style="color: #000">'+msg+'</div>' )
          $("#history").scrollTop($("#history")[0].scrollHeight);
        }
      } )

      });
    </script>

{% endblock %}
